<script>
// Pega os parâmetros
const params = new URLSearchParams(window.location.search);
const luva = params.get("luva");

// Remove o parâmetro da URL para ninguém ver
if (luva === "vaidaroi") {
    const cleanURL = window.location.origin + window.location.pathname;
    window.history.replaceState({}, document.title, cleanURL);
}

// PIXEL: só dispara se tiver o parâmetro correto
if (luva === "vaidaroi") {

    // cria a tag do pixel dinamicamente
    const pixelScript = document.createElement("script");
    pixelScript.src = "https://connect.facebook.net/en_US/fbevents.js";
    pixelScript.async = true;

    pixelScript.onload = () => {
        fbq('init', '813504844807411');

        var key = 'fb_pageview_813504844807411_param_ok';
        try {
            if (!localStorage.getItem(key)) {
                fbq('track', 'PageView');
                localStorage.setItem(key, '1');
            }
        } catch (e) {
            fbq('track', 'PageView');
        }
    };

    document.head.appendChild(pixelScript);

    // cria a função fbq antes de carregar o pixel
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[]}(window, document,'script');
}
</script>
